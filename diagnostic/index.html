<!-- =========================================================
 DomainElevation — /diagnostic
 One-screen intake + quiet weighted scoring (internal)
 Drop-in page. Matches your existing DomainElevation aesthetic.
========================================================== -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Domain Diagnostic — DomainElevation</title>
  <meta name="description" content="A private preliminary assessment of structural naming relevance and category authority." />
  <meta name="robots" content="index,follow" />
  <link rel="canonical" href="https://domainelevation.com/diagnostic" />

  <meta property="og:type" content="website" />
  <meta property="og:title" content="Domain Diagnostic — DomainElevation" />
  <meta property="og:description" content="Preliminary assessment of structural naming relevance and category authority." />
  <meta property="og:url" content="https://domainelevation.com/diagnostic" />
  <meta property="og:image" content="https://domainelevation.com/og.png" />
  <meta name="twitter:card" content="summary_large_image" />

  <link rel="icon" href="/favicon.ico" sizes="any">
  <link rel="icon" type="image/png" sizes="32x32" href="/domainelevation-dot-32.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/domainelevation-dot-192.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/domainelevation-dot-180.png">
  <link rel="icon" type="image/svg+xml" href="/favicon.svg">
  <meta name="theme-color" content="#ffffff">

  <style>
    :root{
      --bg:#fbfaf7;
      --paper:#ffffff;
      --ink:#121212;

      --text-secondary:rgba(18,18,18,.78);
      --text-muted:rgba(18,18,18,.58);

      --border:rgba(18,18,18,.10);
      --border-strong:rgba(18,18,18,.16);

      --accent:#7a4cff;

      --max-width:960px;

      --font-serif: ui-serif, Georgia, "Times New Roman", Times, serif;
      --font-sans: ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;

      --radius:16px;
      --shadow: 0 18px 50px rgba(0,0,0,.06);

      --track:.18em;
    }

    *{ box-sizing:border-box; margin:0; padding:0; }
    html, body{ width:100%; overflow-x:hidden; }

    body{
      background:var(--bg);
      color:var(--ink);
      font-family:var(--font-sans);
      line-height:1.65;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      text-rendering:optimizeLegibility;
    }

    /* subtle grain */
    body::before{
      content:"";
      position:fixed;
      inset:0;
      pointer-events:none;
      background: radial-gradient(transparent 1px, rgba(0,0,0,.02) 1px);
      background-size: 7px 7px;
      opacity:.25;
      mix-blend-mode:multiply;
    }

    a{
      color:inherit;
      text-decoration:none;
      border-bottom:1px solid transparent;
      transition: border-color .15s ease, color .15s ease, opacity .15s ease;
    }
    a:hover{ border-bottom-color:rgba(18,18,18,.40); }

    header{
      position:sticky;
      top:0;
      z-index:10;
      backdrop-filter: blur(8px);
      background: color-mix(in srgb, var(--bg) 88%, transparent);
      border-bottom:1px solid var(--border);
    }

    nav{
      max-width:var(--max-width);
      margin:0 auto;
      padding:18px 22px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:20px;
    }

    .brand{
      font-family:var(--font-serif);
      font-weight:500;
      letter-spacing:-0.01em;
      white-space:nowrap;
      display:flex;
      align-items:baseline;
      gap:.35rem;
    }
    .brand-mark{
      width:10px;
      height:10px;
      border-radius:999px;
      background: var(--accent);
      box-shadow: 0 0 0 3px color-mix(in srgb, var(--accent) 18%, transparent);
      transform: translateY(-1px);
    }

    nav ul{
      list-style:none;
      display:flex;
      align-items:center;
      gap:22px;
      flex-wrap:wrap;
      justify-content:flex-end;
      min-width:0;
    }

    nav ul a{
      font-size:.95rem;
      letter-spacing:.01em;
      color:var(--text-muted);
      padding:8px 0;
    }
    nav ul a:hover{
      color:var(--ink);
      border-bottom-color:rgba(18,18,18,.40);
    }

    nav ul a.active{
      color: var(--ink);
      border-bottom-color: rgba(18,18,18,.45);
      font-weight: 500;
    }

    main{
      max-width:var(--max-width);
      margin:0 auto;
      padding:56px 22px 88px;
      position:relative;
      z-index:1;
    }

    .hero{
      background:var(--paper);
      border:1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding:42px 34px;
    }

    h1{
      font-family:var(--font-serif);
      font-size: clamp(2.05rem, 4.2vw, 3.05rem);
      font-weight: 420;
      letter-spacing:-0.015em;
      line-height:1.14;
      margin-bottom:14px;
      max-width: 26ch;
    }

    .lede{
      max-width: 86ch;
      color: var(--text-secondary);
      font-size: 1.02rem;
      margin-bottom: 12px;
    }

    .fine{
      color: var(--text-muted);
      font-size: .95rem;
      max-width: 90ch;
    }

    section{ margin-top: 34px; }

    .section-card{
      background: var(--paper);
      border:1px solid var(--border);
      border-radius: var(--radius);
      padding:30px 34px;
    }

    h2{
      font-size:.78rem;
      letter-spacing: var(--track);
      text-transform:uppercase;
      color: var(--text-muted);
      margin-bottom:14px;
    }

    .divider{
      height:1px;
      background: var(--border);
      margin: 18px 0 20px;
    }

    /* Form layout */
    form{ margin-top: 12px; }

    .q{
      padding: 14px 0;
      border-top: 1px solid var(--border);
    }
    .q:first-of-type{ border-top: none; padding-top: 0; }
    .q:last-of-type{ padding-bottom: 0; }

    .q label.qt{
      display:block;
      font-weight: 600;
      color: var(--ink);
      margin-bottom: 8px;
      letter-spacing:.005em;
    }

    .opts{
      display:grid;
      gap:10px;
    }

    .opt{
      display:flex;
      gap:10px;
      align-items:flex-start;
      padding:10px 12px;
      border:1px solid var(--border);
      border-radius: 14px;
      background: linear-gradient(
        180deg,
        color-mix(in srgb, var(--paper) 92%, transparent),
        color-mix(in srgb, var(--paper) 78%, transparent)
      );
      transition: transform .12s ease, border-color .12s ease;
    }
    .opt:hover{
      transform: translateY(-1px);
      border-color: var(--border-strong);
    }
    .opt input{
      margin-top: 2px;
      accent-color: var(--accent);
      transform: scale(1.05);
    }
    .opt span{
      color: var(--text-secondary);
      font-size: 1rem;
      line-height: 1.55;
    }

    .row{
      display:grid;
      grid-template-columns: 1fr;
      gap: 12px;
      margin-top: 14px;
    }

    .field{
      width:100%;
      border: 1px solid var(--border);
      background: #fff;
      color: var(--ink);
      border-radius: 14px;
      padding: 12px 14px;
      font: inherit;
      font-size: 14.5px;
      outline: none;
    }
    textarea.field{ min-height: 110px; resize: vertical; }

    .field:focus{
      border-color: color-mix(in srgb, var(--accent) 35%, var(--border));
      box-shadow: 0 0 0 3px color-mix(in srgb, var(--accent) 12%, transparent);
    }

    .ctaRow{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      margin-top: 16px;
    }

    .btn{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap:8px;
      padding: 11px 14px;
      border-radius: 14px;
      border: 1px solid var(--border-strong);
      background: rgba(255,255,255,.55);
      color: var(--ink);
      font-size: 12px;
      letter-spacing: .10em;
      text-transform: uppercase;
      white-space:nowrap;
      cursor:pointer;
    }
    .btn:hover{ border-color: rgba(18,18,18,.28); }
    .btn.primary{
      border-color: color-mix(in srgb, var(--accent) 40%, var(--border-strong));
      background: color-mix(in srgb, var(--accent) 9%, #ffffff);
    }

    .status{
      margin-top: 12px;
      color: var(--text-muted);
      font-size: .95rem;
      line-height: 1.6;
      max-width: 90ch;
    }

    .result{
      margin-top: 18px;
      padding: 18px 18px 16px;
      border: 1px solid var(--border);
      border-radius: 16px;
      background: color-mix(in srgb, var(--paper) 84%, transparent);
      display:none;
    }

    .result h3{
      font-family: var(--font-serif);
      font-weight: 520;
      letter-spacing:-0.01em;
      margin-bottom: 8px;
      font-size: 1.35rem;
    }

    .result p{
      color: var(--text-secondary);
      font-size: 1rem;
      margin: 0 0 10px 0;
      max-width: 85ch;
    }

    .mutedNote{
      color: var(--text-muted);
      font-size: .92rem;
      margin-top: 8px;
    }

    .smallCaps{
      font-size:.78rem;
      letter-spacing: var(--track);
      text-transform:uppercase;
      color: var(--text-muted);
    }

    footer{
      border-top:1px solid var(--border);
      padding:34px 22px;
      background: color-mix(in srgb, var(--bg) 88%, var(--paper));
      position:relative;
      z-index:1;
    }

    .footer-inner{
      max-width:var(--max-width);
      margin:0 auto;
      display:flex;
      justify-content:space-between;
      align-items:center;
      flex-wrap:wrap;
      gap:14px;
    }

    footer p{
      font-size:.92rem;
      color: var(--text-muted);
      margin:0;
      max-width: 78ch;
    }

    .footer-link{
      font-size:.92rem;
      color: var(--text-secondary);
    }

    @media (max-width: 760px){
      nav{ flex-direction:column; align-items:flex-start; gap:12px; }
      nav ul{ justify-content:flex-start; width:100%; gap:16px; }
      .hero{ padding:34px 18px; }
      .section-card{ padding:26px 18px; }
      main{ padding:44px 18px 72px; }
    }

    @media (prefers-color-scheme: dark){
      :root{
        --bg:#0e0f12;
        --paper:#12141a;
        --ink:#f4f5f7;

        --text-secondary:rgba(244,245,247,.78);
        --text-muted:rgba(244,245,247,.56);

        --border:rgba(244,245,247,.10);
        --border-strong:rgba(244,245,247,.16);

        --shadow: 0 18px 50px rgba(0,0,0,.40);
      }

      body::before{
        opacity:.12;
        mix-blend-mode: normal;
        background: radial-gradient(transparent 1px, rgba(255,255,255,.03) 1px);
        background-size: 7px 7px;
      }

      .field{
        background: rgba(255,255,255,.04);
        border-color: var(--border);
        color: var(--ink);
      }

      a:hover{ border-bottom-color: rgba(244,245,247,.35); }
      nav ul a:hover{ border-bottom-color: rgba(244,245,247,.35); }
      nav ul a.active{ border-bottom-color: rgba(244,245,247,.45); }
    }
  </style>
</head>

<body>
  <header class="site-header">
    <nav class="nav" aria-label="Primary navigation">
      <a class="brand" href="/">
        <span class="brand-mark" aria-hidden="true"></span>
        <span>DomainElevation</span>
      </a>

      <ul class="nav-links">
        <li><a href="/">Home</a></li>
        <li><a href="/portfolios">Portfolios</a></li>
        <li><a href="/philosophy">Philosophy</a></li>
        <li><a href="/research">Research</a></li>
        <li><a href="/diagnostic" class="active">Diagnostic</a></li>
        <li><a href="/contact">Contact</a></li>
      </ul>
    </nav>
  </header>

  <main>
    <section class="hero" aria-label="Diagnostic header">
      <h1>Domain Diagnostic — Preliminary Assessment</h1>
      <p class="lede">
        A private, preliminary evaluation of structural naming relevance and category authority.
      </p>
      <p class="fine">
        This diagnostic produces a preliminary signal only. Formal reviews are conducted manually and selectively.
      </p>
    </section>

    <section class="section-card" aria-label="Diagnostic form">
      <h2>Diagnostic Inputs</h2>

      <form id="diagnostic-form" novalidate>
        <!-- =========================
          Section I — Category & Structure
        ========================== -->
        <div class="q">
          <label class="qt">1. The domain is best described as:</label>
          <div class="opts" role="radiogroup" aria-label="Q1">
            <label class="opt"><input type="radio" name="q1" value="cat_def" required><span>A category-defining generic</span></label>
            <label class="opt"><input type="radio" name="q1" value="core_desc"><span>A core category descriptor</span></label>
            <label class="opt"><input type="radio" name="q1" value="brand"><span>A branded or invented name</span></label>
            <label class="opt"><input type="radio" name="q1" value="niche"><span>A modifier or niche phrase</span></label>
          </div>
        </div>

        <div class="q">
          <label class="qt">2. The domain’s meaning is immediately clear to a first-time reader.</label>
          <div class="opts" role="radiogroup" aria-label="Q2">
            <label class="opt"><input type="radio" name="q2" value="sa" required><span>Strongly agree</span></label>
            <label class="opt"><input type="radio" name="q2" value="a"><span>Somewhat agree</span></label>
            <label class="opt"><input type="radio" name="q2" value="n"><span>Neutral / unclear</span></label>
            <label class="opt"><input type="radio" name="q2" value="d"><span>Disagree</span></label>
          </div>
        </div>

        <div class="q">
          <label class="qt">3. This domain could credibly represent an entire market or function — not just a product.</label>
          <div class="opts" role="radiogroup" aria-label="Q3">
            <label class="opt"><input type="radio" name="q3" value="yes_cat" required><span>Yes, at category level</span></label>
            <label class="opt"><input type="radio" name="q3" value="maybe"><span>Possibly, with positioning</span></label>
            <label class="opt"><input type="radio" name="q3" value="unlikely"><span>Unlikely</span></label>
            <label class="opt"><input type="radio" name="q3" value="no"><span>No</span></label>
          </div>
        </div>

        <div class="divider" aria-hidden="true"></div>
        <h2>Market Authority &amp; Scope</h2>

        <div class="q">
          <label class="qt">4. The category this domain addresses is:</label>
          <div class="opts" role="radiogroup" aria-label="Q4">
            <label class="opt"><input type="radio" name="q4" value="global" required><span>Global and cross-industry</span></label>
            <label class="opt"><input type="radio" name="q4" value="large"><span>Large but sector-specific</span></label>
            <label class="opt"><input type="radio" name="q4" value="emerging"><span>Emerging or speculative</span></label>
            <label class="opt"><input type="radio" name="q4" value="narrow"><span>Narrow or declining</span></label>
          </div>
        </div>

        <div class="q">
          <label class="qt">5. Who would most naturally steward this domain?</label>
          <div class="opts" role="radiogroup" aria-label="Q5">
            <label class="opt"><input type="radio" name="q5" value="infra" required><span>Platform or infrastructure company</span></label>
            <label class="opt"><input type="radio" name="q5" value="consortium"><span>Market-leading operator or consortium</span></label>
            <label class="opt"><input type="radio" name="q5" value="vc"><span>Venture-backed product or brand</span></label>
            <label class="opt"><input type="radio" name="q5" value="solo"><span>Individual or small business</span></label>
          </div>
        </div>

        <div class="q">
          <label class="qt">6. The domain’s authority would increase over time rather than decay.</label>
          <div class="opts" role="radiogroup" aria-label="Q6">
            <label class="opt"><input type="radio" name="q6" value="sa" required><span>Strongly agree</span></label>
            <label class="opt"><input type="radio" name="q6" value="a"><span>Likely</span></label>
            <label class="opt"><input type="radio" name="q6" value="u"><span>Uncertain</span></label>
            <label class="opt"><input type="radio" name="q6" value="d"><span>Unlikely</span></label>
          </div>
        </div>

        <div class="divider" aria-hidden="true"></div>
        <h2>Control, Scarcity &amp; Defensibility</h2>

        <div class="q">
          <label class="qt">7. This domain represents a scarce naming position that cannot be easily substituted.</label>
          <div class="opts" role="radiogroup" aria-label="Q7">
            <label class="opt"><input type="radio" name="q7" value="high" required><span>Highly scarce</span></label>
            <label class="opt"><input type="radio" name="q7" value="mod"><span>Moderately scarce</span></label>
            <label class="opt"><input type="radio" name="q7" value="sub"><span>Easily substituted</span></label>
            <label class="opt"><input type="radio" name="q7" value="none"><span>Non-scarce</span></label>
          </div>
        </div>

        <div class="q">
          <label class="qt">8. Comparable alternatives (plurals, hyphenation, extensions) materially weaken authority.</label>
          <div class="opts" role="radiogroup" aria-label="Q8">
            <label class="opt"><input type="radio" name="q8" value="yes" required><span>Yes — alternatives are meaningfully inferior</span></label>
            <label class="opt"><input type="radio" name="q8" value="some"><span>Somewhat</span></label>
            <label class="opt"><input type="radio" name="q8" value="not"><span>Not really</span></label>
            <label class="opt"><input type="radio" name="q8" value="no"><span>No</span></label>
          </div>
        </div>

        <div class="q">
          <label class="qt">9. Control of this domain conveys long-term strategic leverage.</label>
          <div class="opts" role="radiogroup" aria-label="Q9">
            <label class="opt"><input type="radio" name="q9" value="yes" required><span>Yes, structurally</span></label>
            <label class="opt"><input type="radio" name="q9" value="maybe"><span>Potentially</span></label>
            <label class="opt"><input type="radio" name="q9" value="u"><span>Unclear</span></label>
            <label class="opt"><input type="radio" name="q9" value="no"><span>No</span></label>
          </div>
        </div>

        <div class="divider" aria-hidden="true"></div>
        <h2>Intent &amp; Time Horizon</h2>

        <div class="q">
          <label class="qt">10. Intended holding or stewardship horizon:</label>
          <div class="opts" role="radiogroup" aria-label="Q10">
            <label class="opt"><input type="radio" name="q10" value="10" required><span>5–10+ years</span></label>
            <label class="opt"><input type="radio" name="q10" value="5"><span>3–5 years</span></label>
            <label class="opt"><input type="radio" name="q10" value="short"><span>Short-term disposition</span></label>
            <label class="opt"><input type="radio" name="q10" value="u"><span>Undecided</span></label>
          </div>
        </div>

        <div class="q">
          <label class="qt">11. Primary intent for this asset:</label>
          <div class="opts" role="radiogroup" aria-label="Q11">
            <label class="opt"><input type="radio" name="q11" value="infra" required><span>Long-term infrastructure or platform identity</span></label>
            <label class="opt"><input type="radio" name="q11" value="def"><span>Strategic acquisition / defense</span></label>
            <label class="opt"><input type="radio" name="q11" value="mon"><span>Monetization or resale</span></label>
            <label class="opt"><input type="radio" name="q11" value="u"><span>Exploratory / unsure</span></label>
          </div>
        </div>

        <div class="q">
          <label class="qt">12. Are you seeking an objective diagnostic rather than a valuation?</label>
          <div class="opts" role="radiogroup" aria-label="Q12">
            <label class="opt"><input type="radio" name="q12" value="yes" required><span>Yes</span></label>
            <label class="opt"><input type="radio" name="q12" value="some"><span>Somewhat</span></label>
            <label class="opt"><input type="radio" name="q12" value="no"><span>No</span></label>
          </div>
        </div>

        <div class="divider" aria-hidden="true"></div>

        <h2>Optional Context</h2>
        <p class="fine">If you want a formal review option to appear, provide a domain and minimal context.</p>

        <div class="row">
          <input class="field" id="domain" name="domain" placeholder="Domain (optional)" autocomplete="off" />
          <textarea class="field" id="context" name="context" placeholder="Context (optional) — intended use, timeline, decision authority"></textarea>
          <input class="field" id="email" name="email" type="email" placeholder="Email (optional)" autocomplete="email" />
        </div>

        <div class="ctaRow" aria-label="Actions">
          <button class="btn primary" type="submit">Run Preliminary Diagnostic</button>
          <button class="btn" type="button" id="resetBtn">Reset</button>
        </div>

        <div class="status" id="status" aria-live="polite"></div>

        <!-- Result block (no numeric score shown; internal only) -->
        <div class="result" id="result" aria-live="polite">
          <div class="smallCaps">Preliminary Diagnostic Result</div>
          <h3 id="resultTitle"></h3>
          <p id="resultBody"></p>
          <p class="mutedNote" id="resultNext"></p>

          <!-- Formal review CTA (gated) -->
          <div class="divider" aria-hidden="true"></div>
          <div id="formalGate" style="display:none;">
            <div class="smallCaps">Request Formal Review</div>
            <p class="fine" style="margin-top:10px;">
              Formal reviews are conducted privately and selectively. Submission does not guarantee engagement.
            </p>

            <!-- Swap action to your preferred endpoint (Formspree, etc.) -->
            <form id="formal-form" action="mailto:hello@domainelevation.com" method="post" enctype="text/plain">
              <div class="row" style="margin-top:12px;">
                <input class="field" name="name" placeholder="Full name" required />
                <input class="field" name="company" placeholder="Company" />
                <input class="field" name="email" type="email" placeholder="Email" required />
                <input class="field" name="domain" placeholder="Domain(s)" required />
                <textarea class="field" name="message" placeholder="Acquisition / stewardship context" required></textarea>
              </div>
              <div class="ctaRow">
                <button class="btn primary" type="submit">Submit for Formal Review</button>
              </div>
              <p class="mutedNote">If you prefer, email: <a href="mailto:hello@domainelevation.com">hello@domainelevation.com</a></p>
            </form>
          </div>
        </div>

        <!-- Internal debug placeholder (kept hidden; optional to remove) -->
        <div id="internal" style="display:none;"></div>
      </form>
    </section>
  </main>

  <footer>
    <div class="footer-inner">
      <p>Run a preliminary domain diagnostic to assess structural alignment and category authority.</p>
      <a class="footer-link" href="/diagnostic">Domain Diagnostic →</a>
    </div>
  </footer>

  <script>
    (function(){
      const form = document.getElementById('diagnostic-form');
      const statusEl = document.getElementById('status');
      const resultEl = document.getElementById('result');
      const titleEl = document.getElementById('resultTitle');
      const bodyEl  = document.getElementById('resultBody');
      const nextEl  = document.getElementById('resultNext');
      const formalGate = document.getElementById('formalGate');
      const resetBtn = document.getElementById('resetBtn');

      // ==============
      // Quiet, weighted scoring (internal)
      // No numeric score shown to user; used only to pick result state.
      // ==============

      // Weights by question importance (structural > intent)
      const W = {
        q1: 1.15, q2: 1.10, q3: 1.20,
        q4: 1.05, q5: 1.00, q6: 1.10,
        q7: 1.15, q8: 1.00, q9: 1.10,
        q10: 0.90, q11: 0.95, q12: 0.85
      };

      // Each answer maps to a normalized score in [0,1].
      // Higher = stronger alignment with DomainElevation thesis.
      const S = {
        q1: { cat_def: 1.00, core_desc: 0.85, brand: 0.55, niche: 0.35 },
        q2: { sa: 1.00, a: 0.80, n: 0.55, d: 0.30 },
        q3: { yes_cat: 1.00, maybe: 0.70, unlikely: 0.40, no: 0.20 },
        q4: { global: 1.00, large: 0.80, emerging: 0.55, narrow: 0.30 },
        q5: { infra: 1.00, consortium: 0.85, vc: 0.60, solo: 0.35 },
        q6: { sa: 1.00, a: 0.80, u: 0.55, d: 0.30 },
        q7: { high: 1.00, mod: 0.75, sub: 0.45, none: 0.25 },
        q8: { yes: 1.00, some: 0.78, not: 0.52, no: 0.30 },
        q9: { yes: 1.00, maybe: 0.72, u: 0.50, no: 0.28 },
        q10:{ "10": 1.00, "5": 0.78, short: 0.42, u: 0.55 },
        q11:{ infra: 1.00, def: 0.82, mon: 0.48, u: 0.55 },
        q12:{ yes: 1.00, some: 0.75, no: 0.35 }
      };

      // Hard negative gating: If user is explicitly "valuation-seeking" (q12=no),
      // we cap result to Mixed at best.
      function capForValuationSeeking(selected){
        return selected.q12 === 'no';
      }

      function getSelected(){
        const data = new FormData(form);
        const out = {};
        for (const [k, v] of data.entries()){
          if (k.startsWith('q')) out[k] = v;
        }
        return out;
      }

      function computeWeightedScore(sel){
        let totalW = 0;
        let sum = 0;

        for (const q in W){
          const w = W[q];
          const v = sel[q];
          if (!v || !S[q] || S[q][v] === undefined) continue;
          totalW += w;
          sum += w * S[q][v];
        }

        if (totalW <= 0) return 0;
        return sum / totalW; // normalized 0..1
      }

      function pickState(score, valuationCap){
        // Thresholds tuned for institutional tone:
        // >=0.78 strong; 0.58..0.78 mixed; <0.58 misaligned
        if (valuationCap){
          // cap: never show Strong if they selected "No" for objective diagnostic
          if (score >= 0.78) return 'mixed';
          return (score >= 0.58) ? 'mixed' : 'misaligned';
        }
        if (score >= 0.78) return 'strong';
        if (score >= 0.58) return 'mixed';
        return 'misaligned';
      }

      function renderState(state){
        const states = {
          strong: {
            title: 'Structural Alignment Detected',
            body:
              'This asset exhibits indicators consistent with category authority, naming clarity, and long-horizon relevance. Based on the information provided, the domain aligns with characteristics commonly associated with durable naming infrastructure.',
            next:
              'Next step: request a formal review if you are seeking deeper assessment or potential representation.'
          },
          mixed: {
            title: 'Partial Structural Alignment',
            body:
              'This asset shows some indicators of relevance, but also presents limitations related to scope, defensibility, or authority. Further evaluation may be warranted depending on intended use and time horizon.',
            next:
              'Next step: you may request a formal review to explore positioning, risk factors, or alternative strategies.'
          },
          misaligned: {
            title: 'Limited Structural Alignment',
            body:
              'Based on the information provided, this asset does not currently exhibit strong indicators of category-level naming authority. This does not imply lack of value — only that it may not align with DomainElevation’s core thesis.',
            next:
              'Next step: formal review is optional and reserved for exceptional or evolving cases.'
          }
        };

        titleEl.textContent = states[state].title;
        bodyEl.textContent  = states[state].body;
        nextEl.textContent  = states[state].next;
        resultEl.style.display = 'block';
      }

      function shouldShowFormalGate(){
        const domain = (document.getElementById('domain').value || '').trim();
        const email  = (document.getElementById('email').value || '').trim();
        // Gate is intentionally minimal:
        // If they provided a domain OR email, we show the formal form.
        return domain.length > 0 || email.length > 0;
      }

      function allQuestionsAnswered(){
        // Ensure each q1..q12 has a value
        for (let i=1;i<=12;i++){
          const name = 'q'+i;
          const checked = form.querySelector(`input[name="${name}"]:checked`);
          if (!checked) return false;
        }
        return true;
      }

      form.addEventListener('submit', (e)=>{
        e.preventDefault();
        statusEl.textContent = '';
        formalGate.style.display = 'none';

        if (!allQuestionsAnswered()){
          statusEl.textContent = 'Please answer all diagnostic questions to generate a preliminary result.';
          return;
        }

        const selected = getSelected();
        const score = computeWeightedScore(selected);
        const valuationCap = capForValuationSeeking(selected);
        const state = pickState(score, valuationCap);

        // Render
        renderState(state);

        // Quiet internal logging (optional)
        // Remove entirely if you prefer.
        const internal = document.getElementById('internal');
        internal.textContent = JSON.stringify({ score, state, selected }, null, 2);

        // Gate formal review CTA
        if (shouldShowFormalGate()){
          formalGate.style.display = 'block';

          // Prefill the formal form if possible
          const domain = (document.getElementById('domain').value || '').trim();
          const email  = (document.getElementById('email').value || '').trim();
          const context= (document.getElementById('context').value || '').trim();

          const ff = document.getElementById('formal-form');
          if (ff){
            const dEl = ff.querySelector('[name="domain"]');
            const eEl = ff.querySelector('[name="email"]');
            const mEl = ff.querySelector('[name="message"]');

            if (domain && dEl && !dEl.value) dEl.value = domain;
            if (email && eEl && !eEl.value) eEl.value = email;
            if (context && mEl && !mEl.value) mEl.value = context;
          }
        }

        // Subtle scroll into view (optional)
        resultEl.scrollIntoView({ behavior:'smooth', block:'start' });
      });

      resetBtn.addEventListener('click', ()=>{
        form.reset();
        statusEl.textContent = '';
        resultEl.style.display = 'none';
        formalGate.style.display = 'none';
        window.scrollTo({ top: 0, behavior: 'smooth' });
      });
    })();
  </script>
</body>
</html>
